<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>German Job Bot ðŸ‡©ðŸ‡ª</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-900 min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const i18n = {
      en: {
        subtitle: 'Minimal command workflow for job search automation',
        commandPlaceholder: 'search python jobs in berlin / apply top 2 / status',
        send: 'Run', quickActions: 'Quick Actions',
        tabs: { dashboard: 'Dashboard', jobs: 'Jobs', filters: 'Filters', resume: 'Resume', logs: 'Logs' },
        stats: { total: 'Total', found: 'Found', applied: 'Applied', interview: 'Interview', rejected: 'Rejected' },
        emptyJobs: 'No jobs yet',
        filterTitle: 'Filters', keywords: 'Keywords', locations: 'Locations', salaryMin: 'Minimum Salary (â‚¬)', visaOnly: 'Visa sponsorship only',
        save: 'Save', resumeTitle: 'Resume', name: 'Name', email: 'Email', phone: 'Phone', summary: 'Summary', skills: 'Skills',
        logsTitle: 'Logs', noLogs: 'No logs', filtersSaved: 'Filters saved!', resumeSaved: 'Resume saved!',
        commands: { search: 'search python jobs in berlin', apply: 'apply top 2 jobs', status: 'status', help: 'help' }
      },
      de: {
        subtitle: 'Minimaler Command-Workflow fÃ¼r Job-Automation',
        commandPlaceholder: 'suche python jobs in berlin / bewirb dich auf 2 jobs / status',
        send: 'Start', quickActions: 'Schnellaktionen',
        tabs: { dashboard: 'Dashboard', jobs: 'Jobs', filters: 'Filter', resume: 'Lebenslauf', logs: 'Logs' },
        stats: { total: 'Gesamt', found: 'Gefunden', applied: 'Beworben', interview: 'Interview', rejected: 'Abgelehnt' },
        emptyJobs: 'Noch keine Jobs',
        filterTitle: 'Filter', keywords: 'StichwÃ¶rter', locations: 'Standorte', salaryMin: 'Mindestgehalt (â‚¬)', visaOnly: 'Nur Visa-Sponsoring',
        save: 'Speichern', resumeTitle: 'Lebenslauf', name: 'Name', email: 'E-Mail', phone: 'Telefon', summary: 'Zusammenfassung', skills: 'FÃ¤higkeiten',
        logsTitle: 'Logs', noLogs: 'Keine Logs', filtersSaved: 'Filter gespeichert!', resumeSaved: 'Lebenslauf gespeichert!',
        commands: { search: 'suche python jobs in berlin', apply: 'bewirb dich auf 2 jobs', status: 'status', help: 'hilfe' }
      }
    };

    const shell = 'w-full border border-gray-200 rounded-lg px-3 py-2 bg-white focus:outline-none focus:ring-1 focus:ring-gray-300';

    function App() {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [language, setLanguage] = useState('de');
      const [jobs, setJobs] = useState([]);
      const [filters, setFilters] = useState({});
      const [resume, setResume] = useState({});
      const [logs, setLogs] = useState([]);
      const [command, setCommand] = useState('');
      const [isRunning, setIsRunning] = useState(false);
      const t = i18n[language];

      useEffect(() => { Promise.all([fetchJobs(), fetchFilters(), fetchResume(), fetchLogs()]); }, []);
      const fetchJobs = async () => setJobs((await (await fetch('/api/jobs')).json()).jobs || []);
      const fetchFilters = async () => setFilters(await (await fetch('/api/filters')).json());
      const fetchResume = async () => setResume(await (await fetch('/api/resume')).json());
      const fetchLogs = async () => setLogs(await (await fetch('/api/logs')).json());

      const saveFilters = async () => {
        await fetch('/api/filters', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(filters) });
        alert(t.filtersSaved);
      };
      const saveResume = async () => {
        await fetch('/api/resume', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(resume) });
        alert(t.resumeSaved);
      };

      const runCommand = async (cmd = command) => {
        if (!cmd.trim()) return;
        setIsRunning(true);
        try {
          await fetch('/api/command', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ command: cmd, lang: language }) });
          setCommand('');
          await Promise.all([fetchJobs(), fetchLogs()]);
        } finally {
          setIsRunning(false);
        }
      };

      const stats = {
        total: jobs.length,
        found: jobs.filter(j => j.status === 'found').length,
        applied: jobs.filter(j => j.status === 'applied').length,
        interview: jobs.filter(j => j.status === 'interview').length,
        rejected: jobs.filter(j => j.status === 'rejected').length
      };
      const quickActions = [t.commands.search, t.commands.apply, t.commands.status, t.commands.help];

      return (
        <main className="max-w-5xl mx-auto px-4 py-8 space-y-6">
          <header className="border-b border-gray-200 pb-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
            <div>
              <h1 className="text-2xl font-semibold">German Job Bot ðŸ‡©ðŸ‡ª</h1>
              <p className="text-sm text-gray-500">{t.subtitle}</p>
            </div>
            <div className="flex gap-2">
              <button onClick={() => setLanguage('en')} className={`px-3 py-1 rounded-md border ${language === 'en' ? 'bg-gray-900 text-white border-gray-900' : 'border-gray-300'}`}>EN</button>
              <button onClick={() => setLanguage('de')} className={`px-3 py-1 rounded-md border ${language === 'de' ? 'bg-gray-900 text-white border-gray-900' : 'border-gray-300'}`}>DE</button>
            </div>
          </header>

          <section className="space-y-3">
            <div className="flex gap-2">
              <input value={command} onChange={(e) => setCommand(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && runCommand()} placeholder={t.commandPlaceholder} className={shell} />
              <button onClick={() => runCommand()} disabled={isRunning} className="px-4 py-2 rounded-lg bg-gray-900 text-white disabled:opacity-50">{isRunning ? '...' : t.send}</button>
            </div>
            <div className="flex flex-wrap gap-2">
              {quickActions.map(action => <button key={action} onClick={() => runCommand(action)} className="text-xs px-3 py-1 border border-gray-300 rounded-full">{action}</button>)}
            </div>
          </section>

          <nav className="flex gap-2 flex-wrap">
            {['dashboard', 'jobs', 'filters', 'resume', 'logs'].map(tab => (
              <button key={tab} onClick={() => setActiveTab(tab)} className={`px-3 py-1.5 rounded-md border ${activeTab === tab ? 'bg-gray-900 text-white border-gray-900' : 'border-gray-300'}`}>{t.tabs[tab]}</button>
            ))}
          </nav>

          {activeTab === 'dashboard' && (
            <section className="grid grid-cols-2 md:grid-cols-5 gap-3">
              {Object.entries(stats).map(([k, v]) => (
                <div key={k} className="border border-gray-200 rounded-lg p-4">
                  <p className="text-2xl font-semibold">{v}</p>
                  <p className="text-sm text-gray-500">{t.stats[k]}</p>
                </div>
              ))}
            </section>
          )}

          {activeTab === 'jobs' && (
            <section className="space-y-2">
              {jobs.length === 0 ? <p className="text-gray-500">{t.emptyJobs}</p> : jobs.map(job => (
                <div key={job.id} className="border border-gray-200 rounded-lg p-3 flex justify-between gap-2">
                  <div>
                    <p className="font-medium">{job.title}</p>
                    <p className="text-sm text-gray-500">{job.company} Â· {job.platform} Â· {job.location || 'Germany'}</p>
                  </div>
                  <span className="text-xs px-2 py-1 h-fit rounded border border-gray-300">{job.status}</span>
                </div>
              ))}
            </section>
          )}

          {activeTab === 'filters' && (
            <section className="border border-gray-200 rounded-lg p-4 space-y-3 max-w-2xl">
              <h2 className="font-semibold">{t.filterTitle}</h2>
              <div><label className="text-sm text-gray-500">{t.keywords}</label><input className={shell} value={filters.keywords?.join(', ') || ''} onChange={(e)=>setFilters({...filters, keywords:e.target.value.split(',').map(v=>v.trim()).filter(Boolean)})} /></div>
              <div><label className="text-sm text-gray-500">{t.locations}</label><input className={shell} value={filters.locations?.join(', ') || ''} onChange={(e)=>setFilters({...filters, locations:e.target.value.split(',').map(v=>v.trim()).filter(Boolean)})} /></div>
              <div><label className="text-sm text-gray-500">{t.salaryMin}</label><input type="number" className={shell} value={filters.salaryMin || 0} onChange={(e)=>setFilters({...filters, salaryMin:Number(e.target.value)||0})} /></div>
              <label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={filters.requireVisa || false} onChange={(e)=>setFilters({...filters, requireVisa:e.target.checked})} />{t.visaOnly}</label>
              <button onClick={saveFilters} className="px-4 py-2 rounded-lg bg-gray-900 text-white">{t.save}</button>
            </section>
          )}

          {activeTab === 'resume' && (
            <section className="border border-gray-200 rounded-lg p-4 space-y-3 max-w-2xl">
              <h2 className="font-semibold">{t.resumeTitle}</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div><label className="text-sm text-gray-500">{t.name}</label><input className={shell} value={resume.name || ''} onChange={(e)=>setResume({...resume, name:e.target.value})} /></div>
                <div><label className="text-sm text-gray-500">{t.email}</label><input className={shell} value={resume.email || ''} onChange={(e)=>setResume({...resume, email:e.target.value})} /></div>
              </div>
              <div><label className="text-sm text-gray-500">{t.phone}</label><input className={shell} value={resume.phone || ''} onChange={(e)=>setResume({...resume, phone:e.target.value})} /></div>
              <div><label className="text-sm text-gray-500">{t.summary}</label><textarea className={shell} value={resume.summary || ''} onChange={(e)=>setResume({...resume, summary:e.target.value})} /></div>
              <div><label className="text-sm text-gray-500">{t.skills}</label><input className={shell} value={resume.skills?.join(', ') || ''} onChange={(e)=>setResume({...resume, skills:e.target.value.split(',').map(v=>v.trim()).filter(Boolean)})} /></div>
              <button onClick={saveResume} className="px-4 py-2 rounded-lg bg-gray-900 text-white">{t.save}</button>
            </section>
          )}

          {activeTab === 'logs' && (
            <section className="border border-gray-200 rounded-lg p-4 max-w-3xl">
              <h2 className="font-semibold mb-3">{t.logsTitle}</h2>
              <div className="space-y-2 max-h-80 overflow-y-auto">
                {logs.length === 0 ? <p className="text-gray-500">{t.noLogs}</p> : logs.map((log, i) => (
                  <div key={i} className="text-sm border border-gray-200 rounded p-2">
                    <span className="text-gray-400">{new Date(log.timestamp).toLocaleTimeString()}</span>
                    <span className="ml-2">{log.message}</span>
                  </div>
                ))}
              </div>
            </section>
          )}
        </main>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
